
edit.pyはcsvの情報を整形してスプレッドシートに出力するシステムです。

## 概要
ふるさと納税の寄附受付データ（delivery_list*.csv）を処理し、商品カテゴリ別・月別に集計してGoogleスプレッドシートに出力するシステムです。

## 入力データ（CSVファイル）
- **対象ファイル**: `/Users/nj-cmd11/Downloads`フォルダ内の`delivery_list*.csv`
- **条件**: 今日ダウンロードされたファイルのみを処理
- **エンコーディング**: CP932（Shift_JIS）

### 取得するCSV列
1. **返礼品** - 商品名（カテゴリ分類の基準）
2. **出荷予定日** - 月別集計の基準
3. **申込日** - データの参照用
4. **商品コード** - データの参照用
5. **配送ステータス** - 出荷状況判定の基準


## カテゴリ分類

### 商品カテゴリ（get_product_category関数）
- **玄米**: 商品名に「玄米」を含む
- **白米**: 商品名に「白米」を含む
- **無洗米**: 商品名に「無洗」を含む
- **ペットボトル**: 商品名に「ペットボトル」を含む
- **その他**: 上記に該当しない商品（集計対象外）

### 商品タイプ（get_product_type関数）
- **定期便**: 商品名に「定期」を含む
- **単品**: 上記以外

### 数量抽出（get_product_quantity関数）
- **ペットボトル**: 1本〜6本（「1本」「2本」...「6本」）
- **その他カテゴリ**: 5kg〜30kg（「5kg」「10kg」...「30kg」）

### 件数抽出（get_product_count関数）
- **全てのカテゴリ**: csvの1行を1件とする

### 出荷状況（get_delivery_status関数）
- **集計除外**: 「配送キャンセル」「返送」「配送対象外」
- **出荷予定**: 「出荷依頼準備中」「出荷準備中」
- **出荷済み**: 上記以外の配送ステータス

### 日付グループ（get_date_group関数）
- **2日グループ**: 出荷予定日（なければ出荷日）の日が1日～9日
- **10日グループ**: 出荷予定日（なければ出荷日）の日が10日～16日
- **17日グループ**: 出荷予定日（なければ出荷日）の日が17日～23日
- **24日グループ**: 出荷予定日（なければ出荷日）の日が24日～31日
- **判定ロジック**:
  1. 出荷予定日から日を抽出
  2. 出荷予定日が空の場合は出荷日から日を抽出
  3. どちらも空の場合はNone（集計対象外）

## 月別集計
- **対象期間**: 2025年9月以降のすべての月
- **形式**: 「2025年9月」「2025年10月」...「2026年1月」など
- **判定ロジック**:
  1. 出荷予定日（W列）から年月を抽出
  2. 出荷予定日が空の場合は出荷日（AG列）から年月を抽出
  3. どちらも空の場合は2025年10月とする

## スプレッドシート出力先
- **スプレッドシートID**: 1swzp4-ISlM769K_dKR1BpdwQSkV19YmhHZuzwaXQCdI
- **シート名**: 
  - **寄附受付集計**: 既存の集計データ出力先
  - **出荷スケジュール**: 日付グループ別の集計データ出力先
  - **資材消費管理**: 資材カテゴリ別の集計データ出力先（2025年11月以降）

### 出力セル配置
#### 全ての商品(kg/本)
- **玄米**: 7行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **白米**: 11行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **無洗米**: 15行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **ペットボトル**: 32行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）

#### 未出荷商品(kg/本)
- **玄米**: 8行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **白米**: 12行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **無洗米**: 16行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **ペットボトル**: 33行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）

#### 全ての商品(件)
- **玄米**: 9行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **白米**: 13行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **無洗米**: 17行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **ペットボトル**: 34行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）

#### 未出荷商品(件)
- **玄米**: 10行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **白米**: 14行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **無洗米**: 18行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）
- **ペットボトル**: 35行目（定期便: D列〜、単品: E列〜、定期便合計: B列、単品合計: C列）




#### その他
- **A4セル**: 実行日時（例: 「2025年1月15日(水)」）

### 出荷スケジュールシート出力先
- **シート名**: 出荷スケジュール
- **出力範囲**: 月ごとに3列離れた位置に配置
  - **2025年9月**: C3～F10
  - **2025年10月**: J3～M10
  - **2025年11月以降**: 同様に7列間隔で配置（Q列、X列...）

#### 列の構成（各月共通）
- **C列（無洗米列）**: 無洗米の集計データ
- **D列（白米列）**: 白米の集計データ
- **E列（玄米列）**: 玄米の集計データ
- **F列（PB列）**: ペットボトルの集計データ

#### 行の構成（各月・各カテゴリ共通）
- **3行目**: 2日グループの件数
- **4行目**: 2日グループの重量
- **5行目**: 10日グループの件数
- **6行目**: 10日グループの重量
- **7行目**: 17日グループの件数
- **8行目**: 17日グループの重量
- **9行目**: 24日グループの件数
- **10行目**: 24日グループの重量

### 資材消費管理シート出力先
- **シート名**: 資材消費管理
- **対象期間**: 2025年11月以降のすべての月
- **出力範囲**: 月ごとに1列ずつ配置
  - **2025年11月**: C9～C15
  - **2025年12月**: D9～D15
  - **2026年1月以降**: 同様に1列ずつ増加（E列、F列...）

#### 行の構成（各月共通）
- **9行目**: 5kg箱（玄米||無洗米||白米の5kg）
- **10行目**: 10kg箱（玄米||無洗米||白米の10kg）
- **11行目**: 20kg箱（玄米||無洗米||白米の15kg||20kg）
- **12行目**: 30kg箱（玄米||無洗米||白米の25kg||30kg）
- **13行目**: PB2本（ペットボトルの1本||2本）
- **14行目**: PB4本（ペットボトルの3本||4本）
- **15行目**: PB6本（ペットボトルの5本||6本）

#### 資材カテゴリ分類（get_material_category関数）
- **5kg箱**: 玄米・無洗米・白米の5kg商品
- **10kg箱**: 玄米・無洗米・白米の10kg商品
- **20kg箱**: 玄米・無洗米・白米の15kgまたは20kg商品
- **30kg箱**: 玄米・無洗米・白米の25kgまたは30kg商品
- **PB2本**: ペットボトルの1本または2本商品
- **PB4本**: ペットボトルの3本または4本商品
- **PB6本**: ペットボトルの5本または6本商品

## 処理フロー
1. 今日ダウンロードしたdelivery_list*.csvファイルを検索
2. CSVファイルを読み込み、データフレームに結合
3. 必要な列のみを抽出
4. 商品名からカテゴリ・タイプ・数量を分類
5. 出荷予定日から月を抽出
6. 出荷予定日（なければ出荷日）から日付グループを判定
7. 配送ステータスから出荷状況を判定
8. 集計対象外商品を除外
9. 月別・カテゴリ別・タイプ別に集計
10. 未出荷商品（玄米・白米・無洗米・ペットボトル）を別途集計
11. 出荷スケジュール用の集計（月別・日付グループ別・カテゴリ別）
12. Googleスプレッドシート（寄附受付集計シート）に一括書き込み
13. Googleスプレッドシート（出荷スケジュールシート）に一括書き込み
14. Googleスプレッドシート（資材消費管理シート）に一括書き込み

## 注意事項
- 集計対象外の商品名はコンソールに出力される
- 集計除外件数もコンソールに表示される
- 0件の場合は空文字で出力される
- 月は時系列順に自動ソートされる

